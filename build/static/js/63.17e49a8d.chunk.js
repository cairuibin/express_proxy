(this.webpackJsonpzjyz_admin=this.webpackJsonpzjyz_admin||[]).push([[63],{1792:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAQCAYAAADNo/U5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAEwSURBVHgBjZLNTcNAEIXfrNdxLOUAFWA6MBWAJaIIcUoHoYJAB6QCoIJQAjekgIRTAemAdECQCDHI7DC2heJ1fpx3sOzxfPvz5hGqGn2GID2UtxCgCVLTxZk/LbeQBTwuArj0AkZQ6pjC8Y4Q0ey/pCzINaEFZMq+v+ZWzYZYzbCDbKjtx/KMKzvd4bw1KZf0yjI/6RVcJ4RSxzBmjHnzYftOT8kNGvoVpA5w6l1AOYzW93teL4ksALhc/qF7MPdKvTHazWgJjRY9aRqiToYH6PjXBfScvK1YvVYyK9041HkCQHFlzJuVJHtaIiN34QC7SlMglvMYTCf5eTPXNoo/5DR9MWegoZNbpH6/OLLlVoURN+Xi+EWsEO1LdLgLxfURMpQnvhhuFh+meqjj5en4A8P8YAl4RHJHAAAAAElFTkSuQmCC"},1876:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return r})),a.d(t,"d",(function(){return s})),a.d(t,"e",(function(){return c})),a.d(t,"c",(function(){return i}));var n=a(4);function o(e){return Object(n.d)("/api/interaction/api/v1/live/liveRoom/getStudentLiveRoomList",e)}function r(e){return Object(n.c)("/api/interaction/api/v1/live/liveRoom/getGroupId",e)}function s(e){return Object(n.c)("/api/interaction/api/v1/live/liveRoom/getVideoList",e)}function c(e){return Object(n.c)("/api/interaction/api/v1/live/liveRoom/webVerificationLive",e)}function i(e){return Object(n.c)("/api/interaction/api/v1/live/liveRoom/getSdkAppId",e)}},1980:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAbCAYAAACN1PRVAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAGQSURBVHgB7ZYtc8MwDIZlX0lLQ4s3uNLh0o2Oj46W7W60rD9gbLi0o8WlGWzpQjfYwezVVb5zEkd2PmDfO5/S2PITy7JcQ1BZljcw3Np0MMb8tHXCP4O5Q5sFuk/wPfHDBAN5wIraxZCDAnL+mTJmD+DW4nlKOmijrUr8M9K15OhNaBiIuB8T7ai5Dbe13yosWQB+1t/hA+Ywb/47q8zBoVnJ5vf5gALmW4NxyPZjAaG/Npjboy3sbkRgA1ZJBtmDMYDVlTEA7bWedQpwRuk6es+5iY3G5A8wj96rjasIKZKs/IXPOZr6vEI4kACPXUDiX9BVMXVMmEGgBdo72jrlWFhxmnPW9ThHS7FJ59BKGF7okm3avRZS7j2rQOa4+8wNyLqsDmnNdTRaafCbF/JkaaBipU1AXBhotPvMO/g+kMPs9jV4n02pJ5CaK1z6Y0Kw5wEXZh1YUSiMXDjXEhanpP8jjtnWYWWCWHHlld5HxlSSIQgT+0GXr9eU0wAQdDY1Bw5hqNYVfB+RDluQnlxf/xWpxcGCWvTWAAAAAElFTkSuQmCC"},2411:function(e,t,a){},2426:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAIpSURBVHgB7VYtVAJBEB58pLNi1QoVrWSsWoVqt2qGTJYKFTNVM9azQoXKGXG+d3syzNvd2zu54Ht87+3b3dm/b2dmZ5bohBMOUaMS2O12l1y1arXaXMgaXL2YbsxlxuObkP0KkzAEcFjEh/SF/IGrWzX9I4TMGZUkYBleWWQdzDda+jsJs9GTgwDxbXHrIaW3l8C6Aa+/cu0dZA5h74Y6uO+Z3+NyLcQJ9rCZJlcTLgI+4CAuI26+CTE0+Gibf3ZsAorMjKu5ELV4zy7lkeBJEQ4XThhMAAdw6SgxiKxF/16vq6tNYEOozOp8eQQo9QO0O6wFOCm0kXB/zM1nMxWXbLL8K1urNdEuQ8BAauxA7XwggtdWjN/IhYXiRA5ge5/a5dNtUhUkzNMbC1Fk/CqDDGYXVAUJQyRWIhmgEtGOKiOBl6VESci6o5KgNFdISB+RjptUQsI8754QLdk80g9acow8JILU50Bb9ae0JwgzyRex8pHAM4NzwdO3VAyfoj1TTop/xrnov8uF3izKN0D07LjGdRbN/g0yUxrZgPYvIs6iaYY6ecCTX3kT8hFR8zeKFA7Wn6CpXpfrmCDC1YIKwpGB57zfsjAJAxBZBs7NkhlMICMmXsvENj/4o2tUi0z4GwXVRxfjyBcwnQ5auMDI9eENjhNIyZT+IV0auePStRDAixv6ftyFgpUgsrYMf6t+bA6fmHXufakEjNNFMiIKcwALSzI74X/gBxr30GQp83KbAAAAAElFTkSuQmCC"},2427:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAgCAYAAACcuBHKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAJESURBVHgB7VavVwJBEJ7jmbRChQpZK5nMZY3yBxjVilWzVjIYoUqFDFUqVDDifI85nB3vjl0g6Ht87+3b3bmdme9mZn8QnfCHENEeWK/XRe5qURQNjawlU8gn/H3hY++MAiHOHrgVxVmCBojJGP2C134wkd4umwUKgCFg8WXmWBOzzrPoZWJnOthAjI42f+0Q4L+8MWvr3KHVjBmkpZ2VnsiDQFOmK27njrIhofRA4pZbyYdISDrOfReyowl3j+TWjC7cIBJ9bkvaA0xkxe2Vh2MlrnGULsmXBC/Gn6MGLsgTrFNNcQIiczWPrd6ZMYKQtSkg9EoXBdmScTfZmogIz3v0k4oyyLJ8mujaSDRDCLCxpppW1TgWUiREUBs6rVfaTtA5kYJYEcHf5oVd10b1mCS2RGTrvSl5keVlNZ+psd664cd2DhH0AyOvKOcrJXdSfmgk9L2A8DfM91XGmI5GglPQTSGioWukmEXo4JpIIbIlwN90HVTU+JOOSUIRGRvx1Mz1pTbLI4HCmtN+sCTqyfaVM0OnY6QXZt6icmzfkxtGBylXOf4Wx7Yu0IHIEhJI053WK+Q4QPE8kclfHnB7cuuQWyMNcqPwq34KO4wGExE91Mgg5dNQv0u9SCgiLxRQK7igaJMCi9Szwvu1LTcsaqSkCNqaaIjzWo6pDus5UfLeonI3IDXzDJIgcJ1CAK+sxOlS5g6C7g4QYWcg4kREYF/UcPjOOn0hiVSMzAG2sUt7QFJTYYNjI0seLpAPpZ5O+F/4BnA13qRu0UecAAAAAElFTkSuQmCC"},2441:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAdCAYAAADLnm6HAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFvSURBVHgB7ZcvU8NAEMVfGExjY8FWY8HGFovGMeAYXAcHE8eHwBYJthYk0SCJrU1leBtuyvaatPlzvZq+mTd3c3fJ/rp7l6RADxVFMaQT9NAhOoqBYzYX6KnWAAwcsrmmh3CgoM1iSTmbSzqqWZLRP3QaBEGKLQAka4LbmtGvBPmAQwAJLnU/aXGZgDwRZIa+AApkxOZcDY3pAX2Mv71xZl2S0y+EeIcLAANxxOaGjnjjK2tOMjWqAHm2IToDqEAxbzqpmbc3rWRCypE5AWgiA3lPh2YoI8DDEoA52wO40ZwBcgtCMnGnhiZcMy0BOCm7OoZbLQIoCB0n5/ytdA7gPjhq7vmm+qHJSgngRaYsX2qofJbY74Jx3QNjkyrqXKVP/L9D/GbA6Fv1o10A6NMR7gJgriDKUnf+IOki2YjcK4/sntKpdwADIb98cSR9l2BFe4A9gH0KEh4T+NS2MpA3XSgAU7hXo/8EIi9fROv0CzkJd4fla1IIAAAAAElFTkSuQmCC"},2763:function(e,t,a){"use strict";a.r(t);a(2407);var n,o=a(2428),r=a.n(o),s=(a(177),a(110)),c=a.n(s),i=(a(45),a(6)),l=a.n(i),m=(a(40),a(5)),u=a.n(m),d=(a(43),a(2)),g=a.n(d),p=(a(543),a(176)),A=a.n(p),f=(a(54),a(15)),E=a.n(f),S=a(3),I=a.n(S),h=(a(67),a(28)),v=a.n(h),b=a(7),y=a(9),N=a(12),T=a(11),w=a(10),k=(a(204),a(101)),C=a.n(k),x=(a(2409),a(2412)),O=a.n(x),D=a(0),R=a.n(D),B=a(35),L=(a(2411),a(1876)),M=a(2077),j=a.n(M),V=a(2078),U=a.n(V),Y=O.a.Countdown,K=C.a.TabPane,Q=Object(B.g)(n=function(e){Object(T.a)(n,e);var t=Object(w.a)(n);function n(){var e;Object(y.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).state={userId:"",activeKey:"1",sdkAppId:0,client1:null,liveStatus:0,roomId:"",groupID:"",remoteStream:null,remoteStreamId:"",screenStream:null,screenStreamId:"",remoteStreams:[],options:{SDKAppID:1400372143},tim:null,reload:0,taskStatus:0,groupProfile:null,refreshKey:0,memberNum:0,memberPage:0,current:1,offset:0,message:"",messageList:[],testList:[],memberList:[],taskName:"",teacherId:"",audioLevel:30,isPublished:!1,userSig:"",userMark:localStorage.getItem("userInfo")?JSON.parse(localStorage.getItem("userInfo")).user.userMark:"",deadline:null,nick:localStorage.getItem("userInfo")?JSON.parse(localStorage.getItem("userInfo")).user.humanName:"",timeDisplay:{},isLive:!0,isVoice:!0,disabled:!0,initiator:"",teacherJoinRoom:0,imIsReady:0,trtcFailed:0},e.componentDidMount=Object(b.a)(I.a.mark((function t(){var a,n,o,r,s,c;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"true"===(sessionStorage.getItem("cancelModalKey")?sessionStorage.getItem("cancelModalKey"):"")&&v.a.info({content:"\u76f4\u64ad\u7ed3\u675f\uff0c\u8bf7\u9000\u51fa",onOk:function(){return e.props.history.push("/my-live")}}),document.addEventListener("keydown",e.onKeyDown),a=e.props.location.search,n=a.split("?")[1],o=n.includes("%")?decodeURI(n):n,r=JSON.parse(o),s=localStorage.getItem("userInfo")?JSON.parse(localStorage.getItem("userInfo")).user.id:"",c=localStorage.getItem("userInfo")?JSON.parse(localStorage.getItem("userInfo")).user.userMark:"",null!==document.getElementById("content")&&(document.getElementById("content").scrollTop=document.getElementById("end").offsetTop),null!==document.getElementById("contenta")&&(document.getElementById("contenta").scrollTop=document.getElementById("enda").offsetTop),t.next=13,Object(L.c)().then((function(t){console.log(t),e.setState({userSig:t.genSig,sdkAppId:t.sdkappid})}));case 13:return t.next=15,e.setState({userId:s,initiator:r.initiator,roomId:r.roomId,deadline:r.startTime,taskName:r.taskName,teacherJoinRoom:r.teacherStu,client1:j.a.createClient({mode:"live",sdkAppId:e.state.sdkAppId,userId:s,userSig:e.state.userSig}),tim:U.a.create({SDKAppID:e.state.sdkAppId})},(function(){j.a.checkSystemRequirements().then((function(e){e||alert("\u4f60\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u76f4\u64ad")}))}));case 15:return t.next=17,e.getIMEvent(e.state.tim);case 17:return t.next=19,e.imLogin();case 19:return t.next=21,Object(L.a)({roomId:r.roomId,liveTaskId:r.id,userMark:c}).then((function(t){t?e.setState({groupID:t.groupId,taskStatus:t.taskStatus,initiator:t.initiator},(function(){""!==e.state.groupID&&(console.log("\u540e\u53f0\u83b7\u53d6\u804a\u5929\u5ba4\u7fa4\u53f7\u65f6\u4f20\u5165\u7684groupId:::",e.state.groupID),e.state.tim.getGroupProfile({groupID:e.state.groupID,groupCustomFieldFilter:[]}).then((function(t){e.setState({groupProfile:t.data.group,memberNum:t.data.group.memberNum},(function(){var a=parseInt(parseInt(t.data.group.memberNum)/10);e.setState({memberPage:a}),0===e.state.teacherJoinRoom&&e.setState({memberNum:e.state.memberNum-1})}))})).catch((function(e){console.warn("getGroupProfile error:",e)})))})):v.a.info({content:"\u7f51\u7edc\u5f02\u5e38\uff0c\u70b9\u51fb\u5237\u65b0\u91cd\u8bd5",onOk:function(){return window.location.reload()}})}));case 21:4===e.state.taskStatus&&0===e.state.liveStatus&&(e.joinOther(e.state.roomId),e.handleEvents1(e.state.client1),e.setState({liveStatus:1}));case 22:case"end":return t.stop()}}),t)}))),e.removeAll=function(){sessionStorage.setItem("liveListRefreshKey","true"),e.state.tim.logout().then((function(e){})).catch((function(e){console.warn("logout error:",e)})),e.leaveRoom()},e.componentWillUnmount=Object(b.a)(I.a.mark((function t(){return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:document.removeEventListener("keydown",e.onKeyDown),sessionStorage.setItem("liveListRefreshKey","true"),e.state.tim&&e.state.tim.logout().then((function(e){})).catch((function(e){console.warn("logout error:",e)})),e.leaveRoom();case 4:case"end":return t.stop()}}),t)}))),e.getIMEvent=function(){var t=Object(b.a)(I.a.mark((function t(a){return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.on(U.a.EVENT.SDK_READY,(function(t){console.log("TIM.EVENT.SDK_READY"),e.setState({imIsReady:1})}));case 2:a.on(U.a.EVENT.MESSAGE_RECEIVED,function(){var t=Object(b.a)(I.a.mark((function t(a){var n;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=a.data,console.log("\u672c\u6b21\u63a5\u6536\u5230\u7684\u6d88\u606f\u5185\u5bb9\u201c\uff1a\uff1a\uff1a\uff1a\uff1a\uff1a",n),n.forEach((function(t){if("GROUP"===t.conversationType&&t.to===e.state.groupID){console.log("TIM.EVENT.MESSAGE_RECEIVED"),console.log("111\u672c\u6b21\u63a5\u6536\u5230\u7684\u6d88\u606f\u5185\u5bb9\uff1a\uff1a\uff1a",t),console.log(typeof t);var a=t.getElements();a.length&&a.forEach(function(){var t=Object(b.a)(I.a.mark((function t(a){var n,o,r;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=a.content.text,"object"===typeof(o=JSON.parse(n))?(null===o.action||"JOIN_ROOM"!==o.action&&"QUIT_ROOM"!==o.action?null!==o.action&&"TEXT"===o.action?e.state.testList.push(o):"LIVE_BEGIN"===o.action?(console.log("\u76d1\u542c\u5230\u4e86\u5f00\u64ad\u6d88\u606f\uff1a\uff1a",n),console.log("\u5f00\u64ad\u7aef\uff1a\uff1a",o.body.text),0===e.state.liveStatus&&(e.joinOther(e.state.roomId),e.handleEvents1(e.state.client1)),e.setState({liveStatus:1,initiator:o.body.text})):"LIVE_END"===o.action||"LIVE_FORCE_END"===o.action?(sessionStorage.setItem("cancelModalKey","true"),v.a.info({content:"\u8001\u5e08\u5df2\u7ed3\u675f\u76f4\u64ad\uff0c\u8bf7\u9000\u51fa\u76f4\u64ad\u9875\u9762",onOk:function(){return e.props.history.push("/my-live")}}),e.leaveRoom()):"TASK_REMOVED"===o.action?(sessionStorage.setItem("cancelModalKey","true"),v.a.info({content:"\u76f4\u64ad\u4efb\u52a1\u5df2\u53d6\u6d88\uff0c\u8bf7\u7b49\u5f85\u8001\u5e08\u901a\u77e5",onOk:function(){return e.props.history.push("/my-live")}}),e.leaveRoom()):"SHARE_END"===o.action&&((r=e.getDiv("myCamera"))&&e.state.remoteStream.id_===r.substring(7)?(null!==e.state.screenStream&&e.state.screenStream.stop(),null!==e.state.remoteStream&&(e.state.remoteStream.stop(),e.state.remoteStream.play("screen"))):(null!==e.state.screenStream&&e.state.screenStream.stop(),e.setState({screenStream:null}))):(e.state.testList.push(o),"JOIN_ROOM"===o.action?(e.setState({memberNum:e.state.memberNum+1}),"2"===o.body.user.userMark&&e.setState({teacherJoinRoom:1})):(console.log("\u603b\u4eba\u6570-1"),e.setState({memberNum:e.state.memberNum-1}),"2"===o.body.user.userMark&&e.setState({teacherJoinRoom:0})),e.state.groupID&&e.state.tim.getGroupMemberList({groupID:e.state.groupID,count:30,offset:0}).then((function(t){console.log("\u6210\u5458\u5217\u8868",t.data.memberList),e.setState({memberList:t.data.memberList})})).catch((function(e){console.warn("getGroupMemberList error:",e)})),e.setState({current:1})),e.setState({isPublished:!0})):console.log("\u5224\u65ad\u5931\u8d25"),null!==document.getElementById("content")&&(document.getElementById("content").scrollTop=document.getElementById("end").offsetTop),null!==document.getElementById("contenta")&&(document.getElementById("contenta").scrollTop=document.getElementById("enda").offsetTop);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),a.on(U.a.EVENT.CONVERSATION_LIST_UPDATED,(function(e){})),a.on(U.a.EVENT.GROUP_LIST_UPDATED,(function(e){console.log("IM.EVENT.GROUP_LIST_UPDATED")})),a.on(U.a.EVENT.ERROR,function(){var e=Object(b.a)(I.a.mark((function e(t){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("TIM.EVENT.ERROR"),console.log("\u9519\u8bef\u7801",t.data.code),console.log("\u9519\u8bef\u4fe1\u606f",t.data.message),E.a.info("\u804a\u5929\u5ba4\u53d1\u751f\u9519\u8bef,\u6d4f\u89c8\u5668\u5373\u5c06\u5237\u65b0",t.data.message);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.on(U.a.EVENT.SDK_NOT_READY,(function(e){console.log("TIM.EVENT.SDK_NOT_READY"),this.setState({imIsReady:0})})),a.on(U.a.EVENT.KICKED_OUT,(function(e){console.log("TIM.EVENT.KICKED_OUT"),E.a.info("\u88ab\u8e22\u51fa\u804a\u5929\u5ba4")})),a.on(U.a.EVENT.NET_STATE_CHANGE,function(){var t=Object(b.a)(I.a.mark((function t(a){return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("TIM.EVENT.NET_STATE_CHANGE"),t.t0=a.data.state,t.next=t.t0===U.a.TYPES.NET_STATE_CONNECTED?4:t.t0===U.a.TYPES.NET_STATE_CONNECTING?9:t.t0===U.a.TYPES.NET_STATE_DISCONNECTED?13:17;break;case 4:return e.setState({reload:1}),A.a.success({message:"\u63d0\u793a",description:"\u5df2\u63a5\u5165\u7f51\u7edc"}),console.log("what???????"),1===e.state.reload&&(console.log("\u91cd\u542f"),null!==e.state.remoteStream&&e.state.remoteStream.stop(),null!==e.state.screenStream&&e.state.screenStream.stop(),e.joinOther(e.state.roomId),e.handleEvents1(e.state.client1)),t.abrupt("break",17);case 9:return A.a.warning({message:"\u63d0\u793a",description:"\u5f53\u524d\u7f51\u7edc\u4e0d\u7a33\u5b9a"}),e.setState({reload:0}),e.leaveRoom(),t.abrupt("break",17);case 13:return A.a.error({message:"\u63d0\u793a",description:"\u5f53\u524d\u7f51\u7edc\u4e0d\u53ef\u7528"}),e.setState({reload:0}),e.leaveRoom(),t.abrupt("break",17);case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.imLogin=Object(b.a)(I.a.mark((function t(){return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.state.tim.login({userID:e.state.userId,userSig:e.state.userSig}).then((function(e){console.log(e.data),!0===e.data.repeatLogin&&console.log(e.data.errorInfo)})).catch((function(t){console.warn("login error:",t),e.setState({activeKey:"3"})}));case 2:case"end":return t.stop()}}),t)}))),e.joinGroup=function(){e.state.tim.joinGroup({groupID:e.state.groupID,type:U.a.TYPES.GRP_CHATROOM}).then(function(){var e=Object(b.a)(I.a.mark((function e(t){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.data.status,e.next=e.t0===U.a.TYPES.JOIN_STATUS_WAIT_APPROVAL?3:e.t0===U.a.TYPES.JOIN_STATUS_SUCCESS?4:e.t0===U.a.TYPES.JOIN_STATUS_ALREADY_IN_GROUP?7:8;break;case 3:return e.abrupt("break",9);case 4:return console.log("\u52a0\u7fa4\u6210\u529f"),console.log(t.data.group),e.abrupt("break",9);case 7:case 8:return e.abrupt("break",9);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(t){console.warn("joinGroup error:",t),e.setState({activeKey:"3"})}))},e.quitGroup=function(){e.state.tim.quitGroup(e.state.groupID).then((function(e){console.log(e.data.groupID)})).catch((function(e){console.warn("quitGroup error:",e)}))},e.createMessage=Object(b.a)(I.a.mark((function t(){var a,n,o,r,s;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.state.message,""!==e.state.message.trim()){t.next=5;break}return E.a.destroy(),E.a.warning("\u6d88\u606f\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a"),t.abrupt("return");case 5:return e.setState({message:""}),n=new Date,o=n.getHours()+":"+n.getMinutes()+":"+n.getSeconds(),{text:e.state.message,userId:e.state.userId,major:"\u8ba1\u7b97\u673a\u4e13\u4e1a",currentTime:o},r={action:"TEXT",body:{text:a,sendTime:o,user:{id:e.state.userId,humanName:e.state.nick,portraitId:"\u5934\u50cf\u5730\u5740",userMark:"\u7528\u6237\u7c7b\u578b"}}},s=e.state.tim.createTextMessage({to:e.state.groupID,conversationType:U.a.TYPES.CONV_GROUP,payload:{text:JSON.stringify(r)}}),t.next=13,e.state.tim.sendMessage(s);case 13:return t.next=15,e.state.testList.push(r);case 15:e.setState({message:""}),null!==document.getElementById("content")&&(document.getElementById("content").scrollTop=document.getElementById("end").offsetTop),null!==document.getElementById("contenta")&&(document.getElementById("contenta").scrollTop=document.getElementById("enda").offsetTop);case 18:case"end":return t.stop()}}),t)}))),e.getAudioLevel=function(){var t=e.state.remoteStream.getAudioLevel();E.a.info(t)},e.setAudioLevelUp=function(){e.state.remoteStreams.forEach((function(t){t.getUserId()!==e.state.teacherId&&t.play("screen")}))},e.setAudioLevelDown=function(){e.state.remoteStreams.forEach((function(t){t.getUserId()!==e.state.teacherId&&t.stop()}))},e.leaveRoom=Object(b.a)(I.a.mark((function t(){return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.state.client1.leave().catch((function(e){console.error((function(e){console.error("\u9000\u623f\u5931\u8d25 "+e)})).then((function(){console.log("\u9000\u51fa\u76f4\u64ad\u623f\u95f4\u6210\u529f\uff01\uff01\uff01")}))}));case 1:case"end":return t.stop()}}),t)}))),e.joinOther=function(){var t=Object(b.a)(I.a.mark((function t(a){return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.state.client1.join({roomId:a,role:"audience"}).catch((function(e){console.error("\u8fdb\u623f\u5931\u8d25 "+e)})).then((function(){console.log("\u8fdb\u623f\u6210\u529f")}));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleEvents1=function(){var t=Object(b.a)(I.a.mark((function t(a){return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a.on("error",function(){var e=Object(b.a)(I.a.mark((function e(t){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.error(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.on("client-banned",(function(e){console.log("client has been banned for "+e),E.a.error("\u7528\u6237\u88ab\u8e22\u51fa\u623f\u95f4\uff01"),window.location.reload()})),a.on("peer-join",(function(e){var t=e.userId;console.log("peer-join "+t)})),a.on("peer-leave",(function(e){var t=e.userId;console.log("peer-leave "+t)})),a.on("stream-added",(function(t){var n=t.stream;if("main"!==n.getType()&&(E.a.warning("\u76f4\u64ad\u89c6\u9891\u4e2d\u65ad\uff0c\u5373\u5c06\u5237\u65b0\u91cd\u8bd5"),window.location.reload()),n){console.log("\u672c\u6b21\u8fdb\u5165\u7684remoteStream",n);var o=n.getUserId();o.substring(o.length-9,o.length)!==e.state.roomId?e.setState({timeDisplay:{display:"none"},teacherJoinRoom:1,teacherId:o,remoteStream:n,remoteStreamId:r}):e.setState({teacherId:o,screenStream:n,screenStreamId:r}),e.state.remoteStreams.push(n),console.log(e.state.remoteStreams);var r=n.getId();console.log("\u6d41\u7c7b\u578b\uff1a\uff1a",n.getType()),console.log("\u8fdc\u7aef\u6d41\u589e\u52a0: "+r);var s=n.getUserId();console.log("remote stream added: [".concat(s,"] ID: ").concat(r," type: ").concat(n.getType())),a.subscribe(n)}})),a.on("stream-subscribed",function(){var t=Object(b.a)(I.a.mark((function t(a){var n,o,r,s;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=a.stream,o=n.getId(),console.log("\u6d41\u7c7b\u578b\uff1a\uff1a",n.getType()),console.log("\u8fdc\u7aef\u6d41\u8ba2\u9605\u6210\u529f\uff1a"+o),console.log("remoteStream",n),r=n.getUserId(),r.length,console.log("this.state.initiator",e.state.initiator),"APP"!==e.state.initiator){t.next=15;break}return console.log("\u8ba2\u9605\u4e8b\u4ef6play"),t.next=12,n.play("screen").then((function(){})).catch((function(e){n.resume()}));case 12:"APP"===e.state.initiator&&(s=document.getElementById("video_"+o))&&e.state.remoteStream&&e.state.remoteStream.getId()!==o&&(s.style.width="35%"),t.next=16;break;case 15:r.substring(r.length-9,r.length)===e.state.roomId?(null!==e.state.remoteStream&&(e.state.remoteStream.stop(),e.state.remoteStream.play("myCamera").then((function(){})).catch((function(e){console.log("123123123123123123",e.name)}))),n.play("screen").then((function(){})).catch((function(e){console.log("123123123123123123",e.name)}))):n.play("myCamera").then((function(){})).catch((function(e){console.log("123123123123123123",e.name)}));case 16:e.setState({disabled:!1});case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),a.on("stream-removed",(function(t){var a=t.stream,n=a.getId(),o=a.getUserId();console.log("remove\u7684\u8fdc\u7a0b\u6d41",a),a.stop(),o.substring(o.length-9,o.length)!==e.state.roomId?e.setState({disabled:!0,remoteStream:null}):e.setState({screenStream:null}),console.log("stream-removed ID: ".concat(n,"  type: ").concat(a.getType()))})),a.on("stream-updated",(function(t){var a=t.stream,n=a.getId();a.getUserId();if("APP"===e.state.initiator){var o=document.getElementById("video_"+n);console.log(o),console.log(n),o&&(o.style.width="35%")}console.log("type: "+a.getType()+" stream-updated hasAudio: "+a.hasAudio()+" hasVideo: "+a.hasVideo()),console.log("remote\u6d41\u7684id\uff1a\uff1a\uff1a"+a.getId())})),a.on("mute-audio",(function(e){console.log(e.userId+" mute audio")})),a.on("unmute-audio",(function(e){console.log(e.userId+" unmute audio")})),a.on("mute-video",(function(e){console.log(e.userId+" mute video")})),a.on("unmute-video",(function(e){console.log(e.userId+" unmute video")})),a.on("connectHion-state-changed",(function(e){console.log("RtcClient state changed to ".concat(e.state," from ").concat(e.prevState))}));case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.goBack=function(){sessionStorage.setItem("liveListRefreshKey","true"),e.props.history.push("/my-live")},e.callback=function(){var t=Object(b.a)(I.a.mark((function t(a){return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setState({activeKey:a});case 2:if("2"!==e.state.activeKey){t.next=15;break}if(!e.state.tim){t.next=13;break}if(""===e.state.groupID){t.next=9;break}console.log("groupid\u6b63\u5e38\uff1a\uff1a",e.state.groupID),e.state.tim.getGroupMemberList({groupID:e.state.groupID,count:30,offset:0}).then((function(t){console.log(t.data.memberList),e.setState({memberList:t.data.memberList})})).catch((function(e){console.warn("getGroupMemberList error:",e),E.a.warning("\u804a\u5929\u5ba4\u5f02\u5e38\uff0c\u5373\u5c06\u5237\u65b0")})),t.next=11;break;case 9:return t.next=11,e.setState({activeKey:1});case 11:t.next=15;break;case 13:return t.next=15,e.setState({activeKey:1});case 15:null!==document.getElementById("content")&&(document.getElementById("content").scrollTop=document.getElementById("end").offsetTop),null!==document.getElementById("contenta")&&(document.getElementById("contenta").scrollTop=document.getElementById("enda").offsetTop);case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.fullScreen=function(){var e=document.getElementById("screen").getElementsByTagName("video")[0];e&&e.webkitRequestFullScreen()},e.reloadCurrentTime=function(){var e=new Date;return(e.getHours()>0?e.getHours():"0"+e.getHours())+":"+(e.getMinutes()>0?e.getMinutes():"0"+e.getMinutes())},e.countDown=function(){var t=new Date,a=new Date(e.state.deadline);return 4===e.state.taskStatus?R.a.createElement("div",{className:"time",style:e.state.timeDisplay},R.a.createElement("span",{className:"span"},"\u6b63\u5728\u52a0\u8f7d\u76f4\u64ad\uff0c\u8bf7\u7a0d\u5019...")):0!==e.state.taskStatus&&a<t?R.a.createElement("div",{className:"time",style:e.state.timeDisplay},R.a.createElement("span",{className:"span"},"\u8bf7\u7b49\u5f85\u8001\u5e08\u5f00\u59cb\u76f4\u64ad")):1===e.state.taskStatus?R.a.createElement("div",{className:"time",style:e.state.timeDisplay},R.a.createElement("h3",{className:"h3"},R.a.createElement(Y,{value:e.state.deadline,onFinish:function(){return e.setState({timeDisplay:{display:"none"}})}})),R.a.createElement("span",{className:"span"},"\u8ddd\u79bb\u76f4\u64ad\u5f00\u59cb")):void 0},e.onKeyDown=function(){var t=Object(b.a)(I.a.mark((function t(a){return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(13!==a.keyCode){t.next=5;break}return a.preventDefault(),t.next=4,e.createMessage();case 4:e.setState({message:""});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.closeAudio=function(){null!==e.state.remoteStream&&!1!==e.state.isLive&&(e.state.remoteStream.muteAudio(),e.setState({isVoice:!1,disabled:!0}))},e.openAudio=function(){null!==e.state.remoteStream&&!1!==e.state.isLive&&(e.state.remoteStream.unmuteAudio(),e.setState({isVoice:!0,disabled:!1}))},e.onSliderChange=function(t){if(null!==e.state.remoteStream){e.setState({audioLevel:t});var a=t/100;e.state.remoteStream.setAudioVolume(a)}},e.onAfterSliderChange=function(t){if(null!==e.state.remoteStream){e.setState({audioLevel:t});var a=t/100;e.state.remoteStream.setAudioVolume(a)}},e.changeVideo=Object(b.a)(I.a.mark((function t(){var a,n,o;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("APP"!==e.state.initiator){t.next=2;break}return t.abrupt("return");case 2:if(null!==e.state.remoteStream||null!==e.state.screenStream){t.next=4;break}return t.abrupt("return");case 4:if(""===document.getElementById("myCamera").innerHTML){t.next=9;break}a=e.getDiv("myCamera"),t.next=16;break;case 9:if(""===document.getElementById("screen").innerHTML){t.next=15;break}return a=e.getDiv("screen"),t.next=14,e.state.remoteStream.stop();case 14:e.state.remoteStream.play("myCamera");case 15:return t.abrupt("return");case 16:if(null===e.state.remoteStream){t.next=19;break}return t.next=19,e.state.remoteStream.stop();case 19:if(null===e.state.screenStream){t.next=22;break}return t.next=22,e.state.screenStream.stop();case 22:e.state.remoteStream.id_===a.substring(7)?(null!==e.state.remoteStream&&((n=e.getDiv("screen"))&&(n.innerHTML=""),e.state.remoteStream.play("screen")),null!==e.state.screenStream&&((o=e.getDiv("myCamera"))&&(o.innerHTML=""),e.state.screenStream.play("myCamera"))):(null!==e.state.screenStream&&e.state.screenStream.play("screen"),null!==e.state.remoteStream&&e.state.remoteStream.play("myCamera"));case 23:case"end":return t.stop()}}),t)}))),e.getDiv=function(e){var t=document.getElementById(e);if(t)var a=t.getElementsByTagName("div");else E.a.warning("\u83b7\u53d6\u89c6\u9891\u6d41\u6d41\u5f02\u5e38"),window.location.reload();return a[0]?a[0].id:""},e.memberListPageChange=function(t,a){e.setState({current:t}),e.state.tim.getGroupMemberList({groupID:e.state.groupID,count:30,offset:2*(t-1)}).then((function(t){console.log(t.data.memberList),e.setState({memberList:t.data.memberList})})).catch((function(e){console.warn("getGroupMemberList error:",e),E.a.info("\u804a\u5929\u5ba4\u51fa\u9519\uff0c\u5373\u5c06\u5237\u65b0"),window.location.reload()}))},e.keyDown=function(t){13===t.keyCode&&(e.createMessage(),e.setState({message:""}),t.preventDefault())},e.Popups=function(t){e.setState({message:t.target.value});var a="",n="";""==t.target.value.trim()?(a=" rgba(255, 255, 255, 0.5)",n="rgba(255, 255, 255, 0.5)"):(a="rgba(255, 255, 255, 0.5)",n="rgba(255, 255, 255, 1)"),document.getElementById("send-btn").style.borderColor=a,document.getElementById("send-btn").style.color=n},e.doFocus=function(e){e.target.parentNode.style.backgroundColor="rgba(68, 68, 68, 0.8)"},e.doBlur=function(e){e.target.parentNode.style.backgroundColor="rgba(68, 68, 68, 0.4)"},e}return Object(N.a)(n,[{key:"componentWillMount",value:function(){var e=this;window.addEventListener("unload",(function(t){e.removeAll()}))}},{key:"render",value:function(){var e=this,t=document.documentElement.clientHeight-140,n=this.state,o=(n.isLive,n.isCamera,n.isVoice),s=n.disabled,i=(n.pageNum,n.pageSize,n.total,n.activeKey),m=R.a.createElement("div",{className:"Chat-left"},R.a.createElement("div",{className:"Chat-left-top"},R.a.createElement(u.a,{style:{height:t-374},id:"content"},R.a.createElement("span",{className:"time"},this.reloadCurrentTime()),this.state.testList.map((function(t){return"JOIN_ROOM"===t.action||"QUIT_ROOM"===t.action?R.a.createElement("div",{className:"clearfix"},R.a.createElement(g.a,{span:24,className:"left-pic"},R.a.createElement("span",{className:"pic-img"},R.a.createElement("img",{src:a(1792),alt:""}),"\u7cfb\u7edf\u7ba1\u7406\u5458"),R.a.createElement("span",{className:"text left-pic"},R.a.createElement("span",null,"\u7cfb\u7edf\u63d0\u793a\uff1a",t.body.text)))):"TEXT"===t.action&&t.body.user.id===e.state.userId?R.a.createElement("div",{className:"clearfix"},R.a.createElement(g.a,{span:24,className:"right-pic"},R.a.createElement("span",{className:"pic-img"},R.a.createElement("img",{src:a(1792),alt:""}),t.body.user.humanName),R.a.createElement("span",{className:"text"},R.a.createElement("span",null,t.body.text)))):R.a.createElement("div",{className:"clearfix"},R.a.createElement(g.a,{span:24,className:"left-pic"},R.a.createElement("span",{className:"pic-img"},R.a.createElement("img",{src:a(1792),alt:""}),t.body.user.humanName),R.a.createElement("span",{className:"text"},R.a.createElement("span",null,t.body.text))))})),"}",R.a.createElement(g.a,{span:24,id:"end"}))),R.a.createElement("div",{className:"input-box"},R.a.createElement("textarea",{onChange:function(t){return e.Popups(t)},onFocus:this.doFocus,onBlur:this.doBlur,value:this.state.message,maxLength:30,onPressEnter:this.createMessage}," "),R.a.createElement("div",{className:"box-button"},R.a.createElement(l.a,{className:"send",id:"send-btn",onClick:this.createMessage},"\u53d1\u9001")))),d=R.a.createElement("div",{className:"Chat-right"},R.a.createElement(u.a,{style:{height:t-345},className:"Chat-right-box",id:"contenta"},R.a.createElement("div",{className:"clearfix"},this.state.memberList.map((function(t){if(null!==t){if(console.log(e.state.teacherJoinRoom),1===e.state.teacherJoinRoom)return console.log("111111"),R.a.createElement(g.a,{span:12},R.a.createElement("span",{className:"pic"},R.a.createElement("img",{src:a(1792),alt:""}),t.nick));if("Owner"!==t.role)return console.log("000000"),R.a.createElement(g.a,{span:12},R.a.createElement("span",{className:"pic"},R.a.createElement("img",{src:a(1792),alt:""}),t.nick))}}))),R.a.createElement(g.a,{span:24,id:"enda"})),R.a.createElement("div",{className:"clearfix",style:{background:"none"}},R.a.createElement(u.a,null,R.a.createElement(g.a,{span:24,style:{textAlign:"right",marginTop:10,justifyContent:"flex-end"}},R.a.createElement(c.a,{current:this.state.current,onChange:this.memberListPageChange,className:"Pagination-fy",size:"small",pageSize:30,total:this.state.memberNum})))));l.a,this.imLogin;return R.a.createElement("div",{className:"Students-live-pageshow clearfix"},R.a.createElement("div",{className:"pageshow-pic clearfix"},R.a.createElement("div",{className:"top"},R.a.createElement("span",{className:"img",style:{width:"85px"}},R.a.createElement("a",{className:"preview-f",onClick:this.goBack.bind(this)},R.a.createElement("img",{src:a(521),style:{float:"left"},alt:""}),R.a.createElement("span",{className:"text-back",style:{float:"left",fontSize:"16px",color:"#2A283D"}},"\u8fd4\u56de"))),R.a.createElement("span",{className:"title"},this.state.taskName)),R.a.createElement("div",{className:"preview-box"},R.a.createElement("div",{className:"left clearfix",style:{height:t}},R.a.createElement("div",{id:"screen",style:{height:t-100}}),this.countDown(),R.a.createElement("div",{className:"video-box"},R.a.createElement(u.a,{className:"row-box"},R.a.createElement(g.a,{span:1},!0===o?R.a.createElement("span",{className:"img-icon"},R.a.createElement("img",{src:a(2426),alt:"",onClick:this.closeAudio})):R.a.createElement("span",{className:"img-icon"},R.a.createElement("img",{src:a(2427),alt:"",onClick:this.openAudio}))),R.a.createElement(g.a,{span:3},R.a.createElement(r.a,{defaultValue:this.state.audioLevel,disabled:s,onChange:this.onSliderChange,onAfterChange:this.onAfterSliderChange})),R.a.createElement(g.a,{span:18}),R.a.createElement(g.a,{span:1},R.a.createElement("span",{className:"img-icon",onClick:this.fullScreen},R.a.createElement("img",{src:a(1980),alt:""})))))),R.a.createElement("div",{className:"right clearfix"},R.a.createElement(u.a,{className:"Camera"},R.a.createElement(g.a,{span:24,className:"Camera-top"},R.a.createElement("span",{className:"icon",onClick:this.changeVideo},R.a.createElement("img",{src:a(2441),alt:""}))),R.a.createElement(g.a,{span:24,className:"Camera-bottom"},R.a.createElement("div",{className:"img",id:"myCamera"}))),R.a.createElement(u.a,{className:"Chat"},R.a.createElement(g.a,{span:24},R.a.createElement(C.a,{activeKey:i,onChange:this.callback},R.a.createElement(K,{tab:"\u804a\u5929\u5bf9\u8bdd",key:"1"}),R.a.createElement(K,{tab:"\u76f4\u64ad\u8bfe\u6210\u5458",key:"2"})),1==i?m:2==i?d:""))))))}}]),n}(D.Component))||n;t.default=Q}}]);